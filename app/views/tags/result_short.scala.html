@* Copyright 2014 Fabian Steeg, hbz. Licensed under the Eclipse Public License 1.0 *@
@(id:String, doc: play.api.libs.json.JsValue)

@import play.api.libs.json._
@import views.TagHelper
@import views.TagHelper._
@import views.TableRow
@import controllers.nwbib.Lobid

@optional(doc: JsValue, key: String, sep: String, alt: String)={
    @defining((doc \\ key)) { other =>
      @if(!other.isEmpty){
        @sep@(other(0).asOpt[String].getOrElse(other(0).as[Seq[JsValue]].map(_.as[String]).mkString("; ")))
      } else {@alt}
    }
}

@label(keys: Seq[String])={
    @defining(keys.find(s=>(doc\\s).size>0)){key=>
        <td style="text-align: right">
        @if(key.isEmpty){&lt;Kein Autor&gt;} else {
            @defining((doc\\key.get)){hits=>
                 @TagHelper.valueFor(doc, hits.get(0).asOpt[String].getOrElse(hits.get(0).as[Seq[String]].get(0)), TagHelper.gndEntities.get)
            }
        }
        </td>
    }
}

@defining((doc\\"@type").last.asOpt[Seq[String]].getOrElse(Seq((doc\\"@type").last.asOpt[String].get))){t=>
<tr>
  <td> <span title="@Lobid.typeLabel(t)" class="@Lobid.typeIcon(t)"></span> </td>
  <td> <a href="@nwbib.routes.Application.show(id)">
    @optional(doc, "title", "", "<Kein Titel>")
    @optional(doc, "otherTitleInformation", " | ", "")
    @optional(doc, "edition", " | ", "")</a></td>
  @label(Seq("creator", "editor", "contributor"))
  <td style="text-align: right"> @optional(doc, "issued", "", "") </td>
  <td style="text-align: right"> @tags.star_button(id) </td>
</tr>
}